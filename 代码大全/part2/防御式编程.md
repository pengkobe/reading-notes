# 8 防御式编程
> 子程序不应传入错误数据而被破坏

### 保护程序不应非法输入而破坏
1. 检查所有来源于外部数据的值
2. 检查所有参数输入
3. 决定如何处理错误的输入数据

### 断言
1. 建立自己的断言机制，各种不同的语言都有支持断言
2. 使用断言的指导意义
   - 断言用来处理绝不会能发生的情况，错误处理预期会发生的情况
   - 避免把需要执行的代码放到断言中
   - 对于高健壮性代码，应该先使用断言再使用错误

### 错误处理技术
1. 返回中立值，使得至少是可以运行的
2. 切换下一个正确的数值
3. 返回与前次相同的数据
4. 切用最接近的合法值
5. 把警告信息记录到日志中
6. 返回一个错误码
7. 调用错误处理子程序或对象
8. 当错误发生时显示错误信息
9. 用最妥当的方式在局部处理错误
10. 关闭程序


#### 健壮性与正确性
正确性: 不返回接口也比返回不准确的结果好(人身安全类)
健壮性: 以保证程序可以持续的运行下去为目标(消费类)

#### 高层次设计对错误处理的影响
就算是认为绝对不会错误也也要检查下，一般情况下，检测到错误就该记下错误代号和它的描述信息。

### 异常
1. 只有在真正例外的情况下才抛出
2. 避免在构造函数和析构函数中抛出异常，除非可以在同一地方将他们捕获
3. 在恰当的抽象层次抛出
4. 在异常消息中加入导致发生的全部信息
5. 避免使用空的catch语句(至少也该做记录)
6. 了解所有函数可能抛出的异常(多试试)
7. 考虑一个集中的异常报告机制
8. 异常的使用标准化...
9. 考虑异常的替代方案(不要为了因为语言提供该特性就用)

#### 隔离程序，使其包容由错误造成的损害
如使用公共层进行过滤是一个好办法。此外在输入数据时将其转换为恰当的类型有利于降低复杂度。

#### 隔栏与断言的关系
隔栏使得程序可分为一个墙里(使用断言，因为假定是正确的)一个墙外(使用异常，假定不正确)


### 辅助调试代码
1. 不要将产品版的限制强加到开发版上
2. 尽早引入辅助调试代码
3. 采用进攻性编程，开发时惨痛的的失败使得产品发布时不会太惨。
4. 计划移除调试辅助的代码
   - 可以使用ant或make工具
   - 使用内置的预处理器
   - 编写你自己的预处理器
   - 使用调试存根

### 确定产品该保留多少防御性代码



